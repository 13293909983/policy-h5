<!DOCTYPE html>
<html lang="en">

	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<meta http-equiv="X-UA-Compatible" content="ie=edge">
		<title>电子保函服务平台</title>
		<link rel="stylesheet" href="/css/common.css" />
		<link rel="stylesheet" href="/css/index.css" />
        <link rel="stylesheet" href="/css/form.css" />
        <link rel="icon" type="image/x-icon" href="/favicon.ico">
		<script src="/js/jquery-1.9.1.min.js" type="text/javascript"></script>
		<script src="/js/index.js" type="text/javascript"></script>
		<script type="text/javascript" src="/js/paging.js" ></script>
	</head>
<body>
<header></header>
<div class="body_mian">
	<div class="title_wrap">
		<div class="title_nav">
			<h3>产品介绍</h3><img src="/images/xz.png" />
			<h3>立即投保</h3><img src="/images/xz.png" />
		</div>
		<form method="post" action="/applyBidPolicy.json" onsubmit="return onCheck()" enctype="multipart/form-data">
			<input type="hidden" th:value="${message}" id="message"/>
			<!--交易平台流水号-->
			<input type="hidden" th:value="${sequenceNo}" name="sequenceNo"/>
			<table class="formtables" cellspacing="0" cellpadding="0">
				<tr>
					<th colspan="4">被保险人信息</th>

				</tr>
				<tr>
					<td>被保险人名称</td>
					<td>
						<input name="insuredName" class="input-text" placeholder="请输入" th:value="${bidPolicy.insuredName}" onChange="getInsuredName()">
						<br/>
						<i th:text="${errorMap['insuredName']}"></i>
					</td>
					<td>组织机构代码</td>
					<td>
						<input name="insuredIdNo" class="input-text" placeholder="请输入" th:value="${bidPolicy.insuredIdNo}" onChange="getInsuredIdNo()">
						<br/>
						<i th:text="${errorMap['insuredIdNo']}"></i>
					</td>
				</tr>
				<tr>
					<td>社会信用代码</td>
					<td>
						<input name="insuredSocialcode" class="input-text" placeholder="请输入" th:value="${bidPolicy.insuredSocialcode}" onChange="getInsuredSocialcode()">
						<br/>
						<i th:text="${errorMap['insuredSocialcode']}"></i>
					</td>
					<td>联系电话</td>
					<td>
						<input name="insuredIdMobile" class="input-text" placeholder="请输入" th:value="${bidPolicy.insuredIdMobile}" onChange="getInsuredIdMobile()">
						<br/>
						<i th:text="${errorMap['insuredIdMobile']}"></i>
					</td>
				</tr>
				<tr>
					<td>地址</td>
					<td colspan="3">
						<input name="insuredAddress" class="input-text input-textdz" placeholder="请输入" th:value="${bidPolicy.insuredAddress}">
						<br/>
						<i th:text="${errorMap['insuredAddress']}"></i>
					</td>
				</tr>
				<tr>
					<th colspan="4">基本信息</th>

				</tr>
				<tr>
					<td>项目名称</td>
					<td>
						<input name="certificateDepart" class="input-text" placeholder="请输入"  th:value="${bidPolicy.certificateDepart}" onChange="getCertificateDepart()">
						<br/>
						<i th:text="${errorMap['certificateDepart']}"></i>
					</td>
					<td>招标文件编号</td>
					<td>
						<input name="certificateNo" class="input-text" placeholder="请输入" th:value="${bidPolicy.certificateNo}" onChange="getCertificateNo()">
						<br/>
						<i th:text="${errorMap['certificateNo']}"></i>
					</td>
				</tr>
				<tr>
					<td>开标日期</td>
					<td>
						<input name="retroactiveStart" type="date" class="input-text"  th:value="${#dates.format(bidPolicy.retroactiveStart,'yyyy-MM-dd')}" onChange="getRetroactiveStart()">
						<br/>
						<i th:text="${errorMap['retroactiveStart']}"></i>
					</td>
					<td>投标终止日期</td>
					<td>
						<input name="retroactiveEnd" type="date" class="input-text"  th:value="${#dates.format(bidPolicy.retroactiveEnd,'yyyy-MM-dd')}" readonly>
						<br/>
						<i th:text="${errorMap['retroactiveEnd']}"></i>
					</td>
				</tr>
				<tr>
					<td>项目类型</td>
					<td>
						<select name="officeType" class="select-form">
							<option value="01" th:selected="${bidPolicy.officeType=='01'}">工程</option>
							<option value="02" th:selected="${bidPolicy.officeType=='02'}">货物</option>
							<option value="03" th:selected="${bidPolicy.officeType=='03'}">服务</option>
						</select>
						<br/>
						<i th:text="${errorMap['officeType']}"></i>
					</td>
					<td>行业代码</td>
					<td>
						<select name="businesssource" class="select-form">
							<option value="0000">请选择</option>
						</select>
						<br/>
						<i th:text="${errorMap['businesssource']}"></i>
					</td>
				</tr>
				<tr>
					<td>保证金金额</td>
					<td>
						<input name="electricPower" placeholder="请输入"  type="number" class="input-text" th:value="${bidPolicy.electricPower}" onChange="getElectricPower()">
						<br/>
						<i th:text="${errorMap['electricPower']}"></i>
					</td>
					<td>保费金额</td>
					<td>
						<input name="sumPremium" type="number" class="input-text" th:value="${bidPolicy.sumPremium}" readonly/>
						<br/>
						<i th:text="${errorMap['sumPremium']}"></i>
					</td>
				</tr>
				<tr>
					<td>起保日期</td>
					<td>
						<input name="startDate" type="date" style="width:43%" class="input-text" th:value="${#dates.format(bidPolicy.startDate,'yyyy-MM-dd')}" readonly/>
						<input class="input-text" value="00" style="width:30px;" disabled/>&nbsp;&nbsp;时
						<br/>
						<i th:text="${errorMap['startDate']}"></i>
					</td>
					<td>终保日期</td>
					<td>
						<input name="endDate" type="date" style="width:43%"  class="input-text" disabled/>
						<input class="input-text" value="24" style="width:30px;" disabled/>&nbsp;&nbsp;时
					</td>
				</tr>
				<tr>
					<th colspan="4"></th>
				</tr>
				<tr>
				<th>影像文件</th>
				<td>
					<input type='file' id="imageFile" name='imageFile' accept='*.zip' onChange="handleConId_photo(this.files);" onMouseleave="getImageFile()"/>
					<input type="hidden" name="fileKey" th:value="${bidPolicy.fileKey}"/>
					<br/>
					<i th:text="${errorMap['fileKey']}"></i>
				</td>
				<td><img id="fileImg" style="width: 120px;height: 125px;margin-top: 17px;background: #fff;"/></td>
				</tr>
		</table>
		<div class="btn-bottom">
			<button class="quxiao" type="button" onclick="window.location.href = '/index.html'">取消</button>
			<button class="submit">提交</button>
		</div>
	</form>
	</div>
</div>
<footer></footer>
<div class="fixed"></div>
</body>
<script type="text/javascript" th:inline="javascript">
	Date.prototype.format = function(format) {
		var date = {
			"M+" : this.getMonth() + 1,
			"d+" : this.getDate(),
			"h+" : this.getHours(),
			"m+" : this.getMinutes(),
			"s+" : this.getSeconds(),
			"q+" : Math.floor((this.getMonth() + 3) / 3),
			"S+" : this.getMilliseconds()
		};
		if (/(y+)/i.test(format)) {
			format = format.replace(RegExp.$1, (this.getFullYear() + '')
					.substr(4 - RegExp.$1.length));
		}
		for ( var k in date) {
			if (new RegExp("(" + k + ")").test(format)) {
				format = format.replace(RegExp.$1,
						RegExp.$1.length == 1 ? date[k] : ("00" + date[k])
								.substr(("" + date[k]).length));
			}
		}
		return format;
	}
	$(function() {
		//根据起保日期生成终保日期
		$(":input[name='startDate']").change(
				function() {
					if (this.value != "") {
						$(":input[name='endDate']").val(
								new Date(
										new Date(this.value.replace(/-/g, "/"))
												.getTime()
												+ 179 * 24 * 60 * 60 * 1000)
										.format("yyyy-MM-dd"));
					}
				}).change();
		$(":input[name='retroactiveStart']").change(
				function() {
					if (this.value != "") {
						$(":input[name='retroactiveEnd']").val(
								new Date(
										new Date(this.value.replace(/-/g, "/"))
												.getTime()
												+ 90 * 24 * 60 * 60 * 1000)
										.format("yyyy-MM-dd"));
					}
				});
		//默认起保日期
		$(":input[name='startDate']").val(
				new Date(new Date().getTime() + 24 * 60 * 60 * 1000)
						.format("yyyy-MM-dd"));
		$(":input[name='endDate']").val(
				new Date(new Date().getTime() + 180 * 24 * 60 * 60 * 1000)
						.format("yyyy-MM-dd"));
		$(":input[name='electricPower']").blur(function() {
			var electricPower = parseInt(this.value);
			var sumPremium = 0;
			if (electricPower > 0 && electricPower <= 100000) {
				sumPremium = 600;
			} else if (electricPower <= 200000) {
				sumPremium = 800;
			} else if (electricPower <= 800000) {
				sumPremium = electricPower * 0.004;
			}
			$(":input[name='sumPremium']").val(sumPremium);
		});
		//全局错误提示
		if($("#message").val()!=""){
		    alert($("#message").val());
		}
		var fileKey=[[${bidPolicy.fileKey}]];
		console.log(fileKey);
		if(fileKey!=null&&fileKey!=""){
			$("#fileImg").attr("src", "/images/a7.png");
		}
	})
	//上传图片
	function handleConId_photo(files){
		var imgName = document.all.imageFile.value;
		var ext="";
		if(imgName==""){
			alert("请选择需要上传的文件!");
			var fileTd=$("#fileImg").parent();
			fileTd.html('<img id="fileImg" style="width: 120px;height: 125px;margin-top: 17px;background: #fff;">');
	        return false; 
		}else{
			idx = imgName.lastIndexOf(".");   
	        if (idx != -1){   
	            ext = imgName.substr(idx+1).toUpperCase();   
	            ext = ext.toLowerCase( ); 
	            if (ext != 'jpg' && ext != 'png' && ext != 'jpeg'&& ext != 'bmp'&& ext != 'zip'){
	                alert("只能上传.jpg .png .jpeg .bmp .zip类型的文件!"); 
	                var file = document.getElementById('imageFile');
	                file.value = ''; //虽然file的value不能设为有字符的值，但是可以设置为空值
	                file.outerHTML = file.outerHTML; //重新初始化了file的html
	                $("#fileImg").attr("src", "/images/a7.png");
	                return false;  
	            }   
	        }
	        //是否ie
	        var isIE = /msie/i.test(navigator.userAgent) && !window.opera;  
	        var fileSize = 0;       
	        var filemaxsize = 1024*5*1024;//5M
	        //获取file的大小
	        if (isIE && !target.files){       
	            var filePath = target.value;       
	            var fileSystem = new ActiveXObject("Scripting.FileSystemObject");          
	            var file = fileSystem.GetFile (filePath);       
	            fileSize = file.Size;      
	        } else { 
	            fileSize = files[0].size;       
	        }
	        if(fileSize>filemaxsize){
	        	alert("文件大小不能超过5M！");
	        	var file = document.getElementById('imageFile');
                file.value = ''; //虽然file的value不能设为有字符的值，但是可以设置为空值
                file.outerHTML = file.outerHTML; //重新初始化了file的html
                $("#fileImg").attr("src", "/images/a7.png");
                return false;  
	        }
	        var url = null;
	        if (window.createObjectURL != undefined) { // basic
	            url = window.createObjectURL(files[0]);
	        } else if (window.URL != undefined) { // mozilla(firefox)
	            url = window.URL.createObjectURL(files[0]);
	        } else if (window.webkitURL != undefined) { // webkit or chrome
	            url = window.webkitURL.createObjectURL(files[0]);
	        }
	        if(ext=="zip"){
	        	$("#fileImg").attr("src", "/images/a7.png");
	        }else{
	        	$("#fileImg").attr("src", url);
	        }
		}
	}
	function onCheck(){
		var i=0;
		//被保险人名称
		var insuredName=$(":input[name='insuredName']").val();
		if(insuredName=="" || insuredName==null){
			$(":input[name='insuredName']").parent().find("i").text("请输入被保险人名称");
			i++;
		}
		//组织机构代码
		var insuredIdNo=$(":input[name='insuredIdNo']").val();
		if(insuredIdNo=="" || insuredIdNo==null){
			$(":input[name='insuredIdNo']").parent().find("i").text("请输入组织机构代码");
			i++;
		}
		//社会信用代码
		var insuredSocialcode=$(":input[name='insuredSocialcode']").val();
		var regex =/^([0-9ABCDEFGHJKLMNPQRTUWXY]{2})([0-9]{6})([0-9ABCDEFGHJKLMNPQRTUWXY]{10})$/;
		if(insuredSocialcode=="" || insuredSocialcode==null){
			$(":input[name='insuredSocialcode']").parent().find("i").text("请输入社会信用代码");
			i++;
		}else if(!regex.test(insuredSocialcode)){
			$(":input[name='insuredSocialcode']").parent().find("i").text("请输入正确的社会信用代码");
			i++;
		}
		//联系电话
		var insuredIdMobile=$(":input[name='insuredIdMobile']").val();
		var phone=/^(13[0-9]|14[579]|15[0-3,5-9]|16[6]|17[0135678]|18[0-9]|19[89])\d{8}$/;
		if(insuredIdMobile=="" || insuredIdMobile==null){
			$(":input[name='insuredIdMobile']").parent().find("i").text("请输入联系电话");
			i++;
		}else if(!phone.test(insuredIdMobile)){
			$(":input[name='insuredIdMobile']").parent().find("i").text("请输入正确的联系电话");
			i++;
		}
		//地址
		/* var insuredAddress=$(":input[name='insuredAddress']").val();
		if(insuredAddress=="" || insuredAddress==null){
			$(":input[name='insuredAddress']").parent().find("i").text("请输入地址");
			i++;
		} */
		//项目名称
		var certificateDepart=$(":input[name='certificateDepart']").val();
		if(certificateDepart=="" || certificateDepart==null){
			$(":input[name='certificateDepart']").parent().find("i").text("请输入项目名称");
			i++;
		}
		//招标文件编号
		var certificateNo=$(":input[name='certificateNo']").val();
		if(certificateNo=="" || certificateNo==null){
			$(":input[name='certificateNo']").parent().find("i").text("请输入招标文件编号");
			i++;
		}
		//开标日期
		var retroactiveStart=$(":input[name='retroactiveStart']").val();
		if(retroactiveStart=="" || retroactiveStart==null){
			$(":input[name='retroactiveStart']").parent().find("i").text("请输入开标日期");
			i++;
		}
		//保证金金额
		var electricPower=$(":input[name='electricPower']").val();
		if(electricPower=="" || electricPower==null){
			$(":input[name='electricPower']").parent().find("i").text("请输入保证金金额");
			i++;
		}else if(600>electricPower){
			$(":input[name='electricPower']").parent().find("i").text("保证金金额不得小于保费金额");
			i++;
		}
		//影像文件
		var imageFile=$(":input[name='imageFile']").val();
		var fileKey=$(":hidden[name='imageFile']").val();
		if((imageFile=="" || imageFile==null) && fileKey==""){
			$(":input[name='imageFile']").parent().find("i").text("请上传影像文件");
			i++;
		}
		if(i>0){
			return false;
		}
		return true;
	}
	//被保险人名称
	function getInsuredName(){
		var insuredName=$(":input[name='insuredName']").val();
		if(insuredName!=''&&insuredName!=null){
			$(":input[name='insuredName']").parent().find("i").text("");
		}
	}
	//组织机构代码
	function getInsuredIdNo(){
		var insuredIdNo=$(":input[name='insuredIdNo']").val();
		if(insuredIdNo!=''&&insuredIdNo!=null){
			$(":input[name='insuredIdNo']").parent().find("i").text("");
		}
	}
	//社会信用代码
	function getInsuredSocialcode(){
		var insuredSocialcode=$(":input[name='insuredSocialcode']").val();
		if(insuredSocialcode!=''&&insuredSocialcode!=null){
			$(":input[name='insuredSocialcode']").parent().find("i").text("");
		}
	}
	//联系电话
	function getInsuredIdMobile(){
		var insuredIdMobile=$(":input[name='insuredIdMobile']").val();
		if(insuredIdMobile!=''&&insuredIdMobile!=null){
			$(":input[name='insuredIdMobile']").parent().find("i").text("");
		}
	}
	//地址
	/* function getInsuredAddress(){
		var insuredAddress=$(":input[name='insuredAddress']").val();
		if(insuredAddress!=''&&insuredAddress!=null){
			$(":input[name='insuredAddress']").parent().find("i").text("");
		}
	} */
	//项目名称
	function getCertificateDepart(){
		var certificateDepart=$(":input[name='certificateDepart']").val();
		if(certificateDepart!=''&&certificateDepart!=null){
			$(":input[name='certificateDepart']").parent().find("i").text("");
		}
	}
	//招标文件编号
	function getCertificateNo(){
		var certificateNo=$(":input[name='certificateNo']").val();
		if(certificateNo!=''&&certificateNo!=null){
			$(":input[name='certificateNo']").parent().find("i").text("");
		}
	}
	//开标日期
	function getRetroactiveStart(){
		var retroactiveStart=$(":input[name='retroactiveStart']").val();
		if(retroactiveStart!=''&&retroactiveStart!=null){
			$(":input[name='retroactiveStart']").parent().find("i").text("");
		}
	}
	//保证金金额
	function getElectricPower(){
		var electricPower=$(":input[name='electricPower']").val();
		if(electricPower!=''&&electricPower!=null){
			$(":input[name='electricPower']").parent().find("i").text("");
		}
	}
	//影像文件
	function getImageFile(){
		var imageFile=$(":input[name='imageFile']").val();
		if(imageFile!=''&&imageFile!=null){
			$(":input[name='imageFile']").parent().find("i").text("");
		}
	}
</script>
</html>